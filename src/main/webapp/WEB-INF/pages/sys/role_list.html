<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<div class="box-header">
				<h3 class="box-title">角色管理</h3>

				<div class="box-tools">
					<div class="input-group input-group-sm" style="width: 350px;">
						<input type="text" name="table_search" id="searchNameId"
							   class="form-control pull-right" placeholder="角色名">

						<div class="input-group-btn">
							<button type="button" class="btn btn-default btn-search">
								<i class="fa fa-search"></i>
							</button>
							<button type="button" class="btn btn-default btn-add">添加</button>
						</div>
					</div>
				</div>
			</div>
			<!-- /.box-header -->
			<div class="box-body table-responsive no-padding">
				<form>
					<table class="table table-hover">
						<thead>
						<tr>
							<th>序号</th>
							<th>角色名称</th>
							<th>备注</th>
							<th>创建时间</th>
							<th>修改时间</th>
							<th>创建用户</th>
							<th>修改用户</th>
							<th>操作</th>
						</tr>
						</thead>
						<tbody id="tbodyId">
						</tbody>
					</table>
				</form>
			</div>
			<!-- /.box-body -->
			<div id="pageId" class="box-footer clearfix">
			</div>
		</div>
		<!-- /.box -->
	</div>
</div>
<script type="text/javascript">
	$(function(){
		$("#pageId").load("doPageUI.do",function () {
			//$("#mainContentId").removeData();
			doGetObjects();
		});
		$(".input-group-btn")
				.on("click",".btn-search",doQueryRoleObjects)
				.on("click",".btn-add",doLoadEditUI);
		  $("#tbodyId")
				  .on("click",".btn-delete",doDeleteObject)
				  .on("click",".btn-update",doLoadEditUI);
		//这是获取元素$("tbody").on("click",".btn-update",doLoadEditUI);


	});
	function doLoadEditUI() {


		var title;
		if($(this).hasClass('btn-add')){
			title="添加角色";
			doLoadPageUI(title);
		}else if ($(this).hasClass('btn-update')) {
			title="角色修改";
			var id=$(this).parents("tr").data("id");
			doLIstObject(title,id);
		}
	}
	function doLIstObject(title,id) {
		//根据id查找记录，判定记录是否存在
		var data={"id":id};
		var url="role/doFindObjectById.do";
		$.getJSON(url,data,function (result) {
			if (result.state==1){
				//此位置除了要分析正确还要考虑对象不存在的情况
				$("#mainContentId").data("data",result.data)
				$("#mainContentId").data("id",id);
				doLoadPageUI(title);
			}else {
				alert(result.message);
			}

		})
	}

	function doLoadPageUI(title) {
		var url="role/doRoleEditUI.do";
		$("#mainContentId").load(url,function () {
			$(".box-title").html(title);
		})
	}
	function doDeleteObject() {
		//1.获取选中的值(分页显示记录时在tr上要绑定id的值)
		var id=$(this).parents("tr").data("id");
		//2.构建参数对象
		var params={"id":id};
		//3.异步请求执行删除
		var url ="role/doDeleteObject.do";
		$.post(url,params,function (result) {
			if (result.state==1){
				alert(result.message);
				doGetObjects();
			}else {
				alert(result.message);
			}
		})
	}
	function doQueryRoleObjects() {
		//为什么要在此位置初始化pageCurrent的值为1?
		//数据查询时页码的初始位置也应该是第一页
		$("#pageId").data("pageCurrent",1);
		//为什么要调用doGetObjects函数？
		//重用js代码，简化jS代码编写。
		doGetObjects();
	}

	function doGetObjects() {
		//1.params
		//获取在Page.html中绑定的当前页码值
		var pageCurrent = $("#pageId").data("pageCurrent");
		//为什么要执行如下语句的判定，然后初始化pageCurrent的值为1
		//pageCurrent参数在没有赋值的情况下，默认初始值应该为1.
		if (!pageCurrent) {
			pageCurrent=1;
		}
		var pages={"pageCurrent":pageCurrent};
		//如下语句的含义是什么？动态在js对象中添加key/value
		//获取查询时用户输入的名字
		var name=$("#searchNameId").val();
		if(name) pages.name=name;//查询时需要
		//定义url和参数
		var url ="role/doFindPageObjects.do";
		//2.发起异步请求
		//请问如下ajax请求的回调函数参数名可以是任意吗？可以,必须符合标识符的规范
		//3.ajax request
		console.log(pages);
		$.getJSON(url,pages,function (result) {
			//JsonResult->PageObject->List<SysConfigs>+...
			//请问result是一个字符串还是json格式的js对象？对象
			doHandleRoleResponseResult(result);
		});
		//? 请问data函数的含义是什么？(从指定元素上获取绑定的数据)
		//此数据会在何时进行绑定？(setPagination,doQueryObjects)





	}
	function doHandleRoleResponseResult(result) {
		 if (result.state==1){
			 doSetTableBodyRows(result.data.records);
			 doSetPagination(result.data);
		 }else {
			 doSetTableBodyErrors(result.message);
		 }
	}
	/*设置表格内容*/
	function doSetTableBodyRows(records) {
		//1.获取tbody对象，并清空对象
		var tBody=$("#tbodyId");
		tBody.empty();
		//2.迭代records记录，并将其内容追加到tbody
		for (var i in records){
			//2.1 构建tr对象
			var tr = $("<tr></tr>");
			tr.data("id",records[i].id);
			//2.2 构建tds对象
			var tds=doCreateTds(records[i],i);
			//2.3 将tds追加到tr中
			tr.append(tds);
			//2.4 将tr追加到tbody中
			tBody.append(tr);
		}
	}


	function doSetTableBodyErrors(message) {
		//获取body对象并清空
		var tBody=$("#tbodyId");
		tBody.empty();
			//2.1构建tr对象
			var tr=$("<tr></tr>");
			tr.data("id",message[i].id);
			//2.2构建tds对象
			var len=$("table thead").find("tr").find("th").length;
			var td=$("<td></td>");
			td.prop("colspan",len);
			//2.3将tds对象追加到tr中
			tr.append(len);
			//2.4将tr追加到tbody中
			tBody.append(tr);


		//创建td对象
		// var len =$("table thead").find("tr").find("th").length;
		// var td=$("<td></td>");
		// td.prop("colspan",len);
		// td.append(message);
		// tr.append(td);
		// //将tr追加到tbody
		// tBody.append(tr);
	}
	function doCreateTds(row,i){
		var tds=
				"<td>"+(parseInt(i)+1)+"</td>"+
				"<td>"+row.name+"</td>"+
				"<td>"+row.note+"</td>"+
				"<td>"+new Date(row.createdTime).toLocaleString()+"</td>"+
				"<td>"+new Date(row.modifiedTime).toLocaleString()+"</td>"+
				"<td>"+row.createdUser+"</td>"+
				"<td>"+row.modifiedUser+"</td>"+
				"<td><a class='btn-delete'>delete</a>"+
				"&nbsp;<a class='btn-update'>update</a></td>";
		return tds;
	}


</script>











