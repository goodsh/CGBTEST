<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.db.sys.dao.SysDeptDao">

    <!--    <update id="updateObject"-->
    <!--            parameterType="com.db.sys.entity.SysMenu">-->
    <!--        update jtsys. sys_menus-->
    <!--        set-->
    <!--        name=#{name},&lt;!&ndash; 底层会调用对象get方法 &ndash;&gt;-->
    <!--        type=#{type},-->
    <!--        sort=#{sort},-->
    <!--        url=#{url},-->
    <!--        parentId=#{parentId},-->
    <!--        permission=#{permission},-->
    <!--        note=#{note},-->
    <!--        modifiedUser=#{modifiedUser},-->
    <!--        modifiedTime=now()-->
    <!--        where id=#{id}-->
    <!--    </update>-->

    <!--    <insert id="insertObject"-->
    <!--            parameterType="com.db.sys.entity.SysMenu">-->
    <!--        insert into jtsys. sys_menus-->
    <!--        (name,url,type,sort,note,parentId,permission,-->
    <!--         createdTime,modifiedTime,createdUser,modifiedUser)-->
    <!--        values-->
    <!--        (#{name},#{url},#{type},#{sort},#{note},#{parentId},#{permission},-->
    <!--         now(),now(),#{createdUser},#{modifiedUser})-->
    <!--    </insert>-->


    <!--    <select id="findZtreeMenuNodes"-->
    <!--            resultType="com.db.common.vo.Node">-->
    <!--        select id,name,parentId-->
    <!--        from jtsys. sys_menus-->
    <!--    </select>-->


    <!--    &lt;!&ndash; 基于菜单id统计子菜单个数 &ndash;&gt;-->
    <!--    <select id="getChildCount" resultType="int">-->
    <!--        select count(*)-->
    <!--        from jtsys. sys_menus-->
    <!--        where parentId=#{id}-->
    <!--    </select>-->

    <!--    &lt;!&ndash; 基于id删除菜单元素 &ndash;&gt;-->
    <!--    <delete id="deleteObject">-->
    <!--        delete from jtsys. sys_menus-->
    <!--        where id=#{id}-->
    <!--    </delete>-->

    <!-- 查询所有菜单以及上级菜单信息,每行记录都要映射
         为一个map对象 -->
    <select id="findObjects"
            resultType="map"><!-- 这里的map是Map集合的别名 -->
        <!-- 方案1 -->
        <!--
        select c.*,p.name parentName
        from sys_menus c left join sys_menus p
        on c.parentId=p.id
        -->
        <!-- 方案2 -->
        select c.*,(select name
        from jtsys.sys_depts p
        where c.parentId=p.id) parentName
        from jtsys.sys_depts c
    </select>

    <select id="getChildCount" resultType="int">
        select count(*)
        from jtsys.sys_depts
        where parentId = #{id}
    </select>

    <delete id="delObject">
        delete
        from jtsys.sys_depts
        where id = #{id}
    </delete>

    <insert id="insertDeptObject" parameterType="com.db.sys.entity.SysDept">
        insert into jtsys.sys_depts
        (name, sort, note, parentId,
         createdTime, modifiedTime, createdUser, modifiedUser)
        values (#{name}, #{sort}, #{note}, #{parentId},
                now(), now(), #{createdUser}, #{modifiedUser})
    </insert>
    <!--查询id 和上级id和名字 -->
    <select id="findZtreeDeptNodes" resultType="com.db.common.vo.DeptNode">
        select id, name, parentId
        from jtsys.sys_depts;
    </select>

    <!--修改数据 -->
    <update id="updataDeptObject" parameterType="com.db.common.vo.DeptNode">
        update jtsys.sys_depts
        set name=#{name},
            parentId=#{parentId},
            sort=#{sort},
            note=#{note}
        where id = #{id}
    </update>

</mapper>








